<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lylo. — AI for solicitors</title>
<meta name="description" content="Works without internet. Built for security and trust. ET1 and Schedule of Loss drafting.">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0A1220; --bg-soft:#0D1729;
    --text:#F5F7FA; --muted:#C7CCD7;
    --cta:#111722; --radius:20px; --space:22px; --container:1360px;
    --accent:#54a0ff; --lm-size:36px;
    --font:-apple-system, BlinkMacSystemFont,"SF Pro Display","SF Pro Text","Helvetica Neue","Segoe UI",Roboto,Arial,sans-serif;
    --bg-top:#0A1220; --bg-bottom:#080D18;
    --noise:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mO0WQ8AAW0B8w1i6b0AAAAASUVORK5CYII=");
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;font-family:var(--font);color:var(--text);
    -webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;
    background:none;position:relative;min-height:100svh;display:flex;flex-direction:column;
  }
  main{flex:1;display:flex;}

  body::before{
    content:"";position:fixed;inset:0;pointer-events:none;z-index:-1;
    background:
      radial-gradient(1200px 700px at 70% -10%, rgba(84,160,255,.08), transparent 70%),
      radial-gradient(900px 600px at -10% 30%, rgba(25,195,125,.07), transparent 70%),
      linear-gradient(to bottom,var(--bg-top) 0%,var(--bg-top) 40%,var(--bg-bottom) 100%);
  }
  body::after{content:"";position:fixed;inset:0;pointer-events:none;background-image:var(--noise);opacity:.05;mix-blend-mode:soft-light;}

  /* Header */
  header.site-header{
    position:fixed; top:0; left:0; right:0; z-index:1000;
    height:64px;
    background:linear-gradient(180deg, var(--bg-soft) 0%, #0B1526 100%);
    border-bottom:1px solid rgba(255,255,255,.08);
    display:flex; align-items:center; justify-content:center;
    box-shadow:0 1px 0 rgba(255,255,255,0.06);
  }
  .header-inner{width:100%; max-width:var(--container);padding:0 16px; display:flex; align-items:center; justify-content:space-between;}
  .logo-small{font-family:'Cormorant Garamond', serif;font-weight:600; font-size:26px; letter-spacing:-.02em;color:var(--text); text-decoration:none;}

  /* Hamburger */
  .hamburger{width:40px; height:36px; position:relative; cursor:pointer;display:flex; align-items:center; justify-content:center;border:none; background:none; padding:0;}
  .hamburger:focus-visible{ outline:2px solid rgba(84,160,255,.45); border-radius:8px; }
  .hamburger .line{position:absolute; width:22px; height:2px; background:var(--text);border-radius:2px; transition:transform .25s ease, opacity .2s ease, width .2s ease;}
  .hamburger .line.top{ transform:translateY(-6px); }
  .hamburger .line.middle{ transform:translateY(0); }
  .hamburger .line.bottom{ transform:translateY(6px); }
  .hamburger[aria-expanded="true"] .line.top{ transform:rotate(45deg); }
  .hamburger[aria-expanded="true"] .line.middle{ opacity:0; }
  .hamburger[aria-expanded="true"] .line.bottom{ transform:rotate(-45deg); }

  /* Mobile menu */
  .nav-panel{position:fixed; inset:0; z-index:999;background:var(--bg); display:none;}
  .nav-panel.open{ display:block; }
  .nav-panel .panel-inner{max-width:var(--container); margin:0 auto; height:100%;padding:88px 20px 24px; display:flex; flex-direction:column; gap:22px;}
  .nav-panel a{color:var(--text); text-decoration:none;font-weight:600; font-size:22px; letter-spacing:0.01em;padding:14px 2px; border-bottom:1px solid rgba(255,255,255,.08);}

  /* Hero */
  .wrap{
    width:100%;max-width:var(--container);margin:auto;
    padding:calc(64px + 60px) var(--space) clamp(28px,4vh,60px);
    display:grid; justify-items:center; gap:0;
  }
  @media(max-width:979px){
    .wrap{
      grid-template-columns: 1fr;
      grid-template-areas:
        "logo"
        "tagline"
        "visual"
        "bullets"
        "cta"
        "note";
      padding:calc(64px + 24px) var(--space) clamp(20px,3vh,40px);
    }
    .logo{ margin-bottom:8px; }
    .tagline{ margin-bottom:22px; }
  }
  @media(min-width:980px){
    .wrap{
      grid-template-columns: 1fr 1.35fr; align-items:center;
      grid-template-areas:
        "logo    visual"
        "tagline visual"
        "bullets visual"
        "cta     visual"
        "note    visual";
    }
  }

  .logo{grid-area:logo; font-family:'Cormorant Garamond', serif;font-weight:600; font-size:88px; letter-spacing:-.03em; line-height:1;text-align:center; margin:0 0 12px;}
  .tagline{grid-area:tagline; font-family:var(--font);font-size:28px; line-height:1.4; letter-spacing:-0.01em;font-weight:400; text-align:center; margin:0 0 30px;}
  .bullets{grid-area:bullets;list-style:none;padding:0;display:grid;gap:12px;justify-content:center;max-width:640px;text-align:center;margin:0 0 20px;}
  .bullet{font-family:var(--font);font-size:17px;line-height:1.55;max-width:440px;margin:0 auto;}

  /* CTA with shimmer */
  .cta{
    grid-area:cta; display:inline-block; width:auto; padding:12px 20px;
    text-align:center; font-weight:600; font-size:16px; color:var(--text);
    border:1px solid transparent; border-radius:var(--radius);
    background:
      linear-gradient(180deg,#111722 0%, #0C1423 100%) padding-box,
      conic-gradient(from 0deg,#ff6b6b,#feca57,#1dd1a1,#54a0ff,#5f27cd,#ff6b6b) border-box;
    background-size:200% 200%;
    position:relative; z-index:0; overflow:hidden; text-decoration:none; cursor:pointer;
    outline:2px solid rgba(84,160,255,.18); outline-offset:2px;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.10), 0 6px 20px rgba(0,0,0,.45);
    margin:0 auto 10px;
    transition: transform .25s ease, box-shadow .25s ease, background-position 1.2s ease, opacity .2s ease;
  }
  .cta:hover{transform:translateY(-1px);box-shadow:inset 0 1px 0 rgba(255,255,255,.10), 0 10px 28px rgba(0,0,0,.5);background-position:100% 0;}
  .cta.loading{pointer-events:none;cursor:wait;opacity:0.95;animation: ctaShimmer 0.9s linear infinite;}
  @keyframes ctaShimmer { 0%{background-position:0% 0} 100%{background-position:100% 0} }

  .note{grid-area:note;color:var(--muted);font-size:13px;margin:4px 0 0;text-align:center;}

  /* Video area */
  .visual{grid-area:visual;display:flex;align-items:center;justify-content:center;width:100%;margin:8px 0 20px;}
  .video-wrapper{position:relative;width:100%;max-width:900px;background:#000;border-radius:calc(var(--radius) - 4px);overflow:hidden;box-shadow:0 20px 50px rgba(0,0,0,.5);}
  .video-wrapper video{width:100%;height:auto;max-height:62vh;display:block;object-fit:cover;border-radius:0;}
  @media(max-width:980px){.video-wrapper{border:1px solid rgba(245,247,250,0.22);}}

/* Controls */
  .fullscreen-btn,
  .pause-btn{
    position:absolute;bottom:48px;background:rgba(17,23,34,.7);color:var(--text);
    font-size:18px;font-weight:600;line-height:1;padding:8px 12px;border:none;border-radius:10px;
    cursor:pointer;transition:background .2s ease,transform .06s ease;z-index:3;
  }
  .fullscreen-btn:hover,.pause-btn:hover{background:rgba(17,23,34,.9);transform:translateY(-1px);}
  .fullscreen-btn{ right:12px; display:flex; }  /* <-- visible by default (fix) */
  .pause-btn{ left:12px; display:none; }       /* only visible in fullscreen */

/* "i" pill */
  .learnmore-btn{
    position:absolute;top:12px;right:12px;z-index:3;
    display:inline-flex;align-items:center;justify-content:center;
    width:var(--lm-size); height:var(--lm-size); padding:0; gap:0;
    border-radius:999px;font-size:14px;font-weight:600;text-decoration:none;color:var(--text);
    background:rgba(17,23,34,0.6);backdrop-filter:blur(4px) saturate(115%);
    border:1px solid rgba(84,160,255,0.4);box-shadow:0 0 4px rgba(84,160,255,0.25);
    transition:width .25s ease,height .25s ease,padding .25s ease,gap .25s ease,background .25s ease;
  }
  .learnmore-btn svg{flex:0 0 auto;display:block;opacity:.95}
  .learnmore-btn .label{display:inline-block;overflow:hidden;white-space:nowrap;max-width:0;opacity:0;margin-left:0;transition:max-width .35s ease, opacity .25s ease, margin-left .25s ease;}
  .learnmore-btn.expanded,.learnmore-btn:hover,.learnmore-btn:focus-visible{width:auto;height:var(--lm-size);padding:8px 14px;gap:6px;}
  .learnmore-btn.expanded .label,.learnmore-btn:hover .label,.learnmore-btn:focus-visible .label{max-width:120px;opacity:1;margin-left:2px;}
  .learnmore-btn:hover{background:rgba(17,23,34,0.8);}

/* Native fullscreen (desktop/tablet) */
  .video-wrapper:fullscreen,.video-wrapper:-webkit-full-screen{width:100vw;height:100vh;max-width:none;border-radius:0;}
  .video-wrapper:fullscreen video,.video-wrapper:-webkit-full-screen video{width:100%;height:100%;max-height:none;object-fit:contain;border-radius:0;box-shadow:none;}
  .video-wrapper:fullscreen .learnmore-btn,.video-wrapper:-webkit-full-screen .learnmore-btn{ display:none; }

  /* Show timeline & pause button ONLY when native fullscreen (desktop) */
  .video-wrapper:fullscreen .timeline,
  .video-wrapper:-webkit-full-screen .timeline,
  .video-wrapper:fullscreen .pause-btn,
  .video-wrapper:-webkit-full-screen .pause-btn{
    display:flex;
  }
  /* Reposition buttons in native fullscreen for comfort */
  .video-wrapper:fullscreen .fullscreen-btn,
  .video-wrapper:-webkit-full-screen .fullscreen-btn{
    top:calc(env(safe-area-inset-top, 0px) + 12px); right:calc(env(safe-area-inset-right, 0px) + 12px); bottom:auto;
  }
  .video-wrapper:fullscreen .pause-btn,
  .video-wrapper:-webkit-full-screen .pause-btn{
    top:calc(env(safe-area-inset-top, 0px) + 12px); left:calc(env(safe-area-inset-left, 0px) + 12px); bottom:auto;
  }

/* ===== Timeline (hidden by default; only in fullscreen) ===== */
  .timeline{
    position:absolute; left:10px; right:10px; bottom:12px; height:16px; z-index:3;
    display:none; align-items:center; touch-action:none; user-select:none;
  }
  .timeline .track{
    position:relative; width:100%; height:6px; border-radius:999px; overflow:hidden;
    background:rgba(255,255,255,.14); box-shadow:inset 0 1px 0 rgba(0,0,0,.25);
    transition:height .15s ease;
  }
  .timeline:hover .track,
  .timeline.dragging .track{ height:8px; }
  .timeline .buffer{position:absolute; left:0; top:0; bottom:0; width:0%; background:rgba(255,255,255,.24);}
  .timeline .progress{position:absolute; left:0; top:0; bottom:0; width:0%; background:linear-gradient(90deg, rgba(84,160,255,.9), rgba(84,160,255,.6));}
  .timeline .handle{position:absolute; top:50%; transform:translate(-50%,-50%); width:12px; height:12px; border-radius:999px; background:#fff; opacity:.95; box-shadow:0 2px 8px rgba(0,0,0,.35); pointer-events:none;}

  /* iOS simulated fullscreen overlay */
  .fs-overlay{
    position:fixed; inset:0; z-index:20000; background:#000; display:none;
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
  }
  .fs-overlay.open{ display:flex; align-items:center; justify-content:center; }
  .fs-overlay .video-wrapper{ width:100%; height:100%; max-width:none; border-radius:0; box-shadow:none; }
  .fs-overlay .video-wrapper video{ width:100%; height:100%; max-height:none; object-fit:contain; }
  .fs-overlay .learnmore-btn{ display:none; }

  /* Show controls inside overlay (fullscreen state on mobile/iOS) */
  .fs-overlay .timeline,
  .fs-overlay .pause-btn,
  .fs-overlay .fullscreen-btn{ display:flex; }

  /* Safe-area aware placement in overlay */
  .fs-overlay .fullscreen-btn{ right:calc(env(safe-area-inset-right) + 12px); bottom:calc(env(safe-area-inset-bottom) + 48px); top:auto; }
  .fs-overlay .pause-btn{ left:calc(env(safe-area-inset-left) + 12px); bottom:calc(env(safe-area-inset-bottom) + 48px); top:auto; }
  .fs-overlay .timeline{ left:calc(env(safe-area-inset-left) + 10px); right:calc(env(safe-area-inset-right) + 10px); bottom:calc(env(safe-area-inset-bottom) + 12px); }

  footer{text-align:center;padding:20px 0;border-top:1px solid rgba(255,255,255,.06);color:var(--muted);font-size:14px;}
</style>
</head>
<body>

<header class="site-header" role="banner">
  <div class="header-inner">
    <a href="/" class="logo-small">Lylo.</a>
    <button class="hamburger" id="hamburger" aria-label="Open menu" aria-controls="mobileMenu" aria-expanded="false">
      <span class="line top"></span><span class="line middle"></span><span class="line bottom"></span>
    </button>
  </div>
</header>

<nav class="nav-panel" id="mobileMenu" aria-hidden="true">
  <div class="panel-inner"><a href="/research">Survey</a></div>
</nav>

<main>
  <div class="wrap">
    <h1 class="logo">Lylo.</h1>
    <p class="tagline">Offline, secure AI for solicitors.</p>

    <aside class="visual">
      <div class="video-wrapper" id="videoWrapper">
        <video id="lyloVideo" autoplay loop muted playsinline webkit-playsinline preload="metadata"
          poster="/static/poc.jpg" aria-label="Demo video showing Lylo drafting a Schedule of Loss.">
          <source src="/static/poc.mp4" type="video/mp4">
          <source src="/static/poc.webm" type="video/webm">
          <img src="/static/poc.jpg" alt="Lylo demo fallback image">
        </video>

        <a href="/demo" class="learnmore-btn" id="learnMoreBtn" aria-label="Learn more about this demo">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.6" opacity="0.9"/>
            <path d="M12 17v-6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <circle cx="12" cy="7.5" r="1.2" fill="currentColor"/>
          </svg>
          <span class="label">Learn more</span>
        </a>

        <!-- Fullscreen toggle (visible in normal view too) -->
        <button class="fullscreen-btn" id="fullscreenToggle" aria-label="Enter fullscreen">⤢</button>
        <!-- Play/Pause toggle (shows only in fullscreen) -->
        <button class="pause-btn" id="pauseToggle" aria-label="Pause">❚❚</button>

        <!-- Timeline (only in fullscreen) -->
        <div class="timeline" id="videoTimeline" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-label="Video progress">
          <div class="track">
            <div class="buffer" id="tlBuffer"></div>
            <div class="progress" id="tlProgress"></div>
          </div>
          <div class="handle" id="tlHandle" aria-hidden="true"></div>
        </div>
      </div>
    </aside>

    <ul class="bullets">
      <li class="bullet">Retrieval based chat system, featuring specialist modules for Employment Law to support drafting Statements of Fact, ET1s, and Schedules of Loss.</li>
    </ul>

    <a href="/research" class="cta" id="joinCta">Join the waitlist</a>
    <div class="note">In development stages. Register interest.</div>
  </div>
</main>

<footer>
  &copy; <script>document.write(new Date().getFullYear())</script> Lylo. All rights reserved.
</footer>

<script>
  /* ===== Mobile menu ===== */
  const hamburger = document.getElementById('hamburger');
  const mobileMenu = document.getElementById('mobileMenu');
  function setMenu(open){
    hamburger.setAttribute('aria-expanded', open ? 'true' : 'false');
    mobileMenu.classList.toggle('open', open);
    mobileMenu.setAttribute('aria-hidden', open ? 'false' : 'true');
    document.body.style.overflow = open ? 'hidden' : '';
  }
  hamburger.addEventListener('click', () => setMenu(hamburger.getAttribute('aria-expanded') !== 'true'));

  /* ===== “Learn more” pill ===== */
  const learnMoreBtn = document.getElementById('learnMoreBtn');
  const learnMoreLabel = learnMoreBtn.querySelector('.label');
  function openLabel(){learnMoreBtn.classList.add('expanded'); const w=learnMoreLabel.scrollWidth; learnMoreLabel.style.maxWidth=w+'px'; learnMoreLabel.style.opacity='1'; learnMoreLabel.style.marginLeft='2px';}
  function closeLabel(){learnMoreLabel.style.maxWidth='0px'; learnMoreLabel.style.opacity='0'; learnMoreLabel.style.marginLeft='0'; learnMoreBtn.classList.remove('expanded');}
  function expandCycle(){openLabel(); setTimeout(()=>{ if(!learnMoreBtn.matches(':hover,:focus,:focus-visible')) closeLabel(); }, 4000);}
  setTimeout(()=>{ expandCycle(); setInterval(expandCycle, 20000); }, 7000);
  learnMoreBtn.addEventListener('mouseenter', openLabel);
  learnMoreBtn.addEventListener('focus', openLabel);
  learnMoreBtn.addEventListener('mouseleave', closeLabel);
  learnMoreBtn.addEventListener('blur', closeLabel);

  /* ===== Video handling (iOS simulated fullscreen to avoid exit-freeze) ===== */
  const wrapper = document.getElementById('videoWrapper');
  let video = document.getElementById('lyloVideo');
  const fsBtn = document.getElementById('fullscreenToggle');
  const pauseBtn = document.getElementById('pauseToggle');

  const IS_IOS = (() => {
    const ua = navigator.userAgent || '';
    const platform = navigator.platform || '';
    const macTouch = platform === 'MacIntel' && navigator.maxTouchPoints > 1;
    return /iPad|iPhone|iPod/.test(ua) || macTouch;
  })();

  function safePlay(v=video){ try{ v.play().catch(()=>{});}catch(e){} }

  /* Frame progress watch */
  let lastFrameTS = performance.now();
  function startFrameWatch(v){
    if ('requestVideoFrameCallback' in HTMLVideoElement.prototype){
      const loop = () => v.requestVideoFrameCallback((now)=>{ lastFrameTS = now; loop(); });
      loop();
    } else {
      v.addEventListener('timeupdate', ()=>{ lastFrameTS = performance.now(); });
    }
  }
  function framesStale(ms){ return (performance.now() - lastFrameTS) > ms; }

  function rebuildVideoInline(){
    const currentTime = video.currentTime || 0;
    const fresh = video.cloneNode(true);
    fresh.removeAttribute('id');
    video.parentNode.replaceChild(fresh, video);
    fresh.id = 'lyloVideo';
    video = fresh;

    const onReady = () => {
      try { video.currentTime = Math.max(0, currentTime - 1.0); } catch(e){}
      safePlay();
      updatePauseBtnUI();
    };
    if (video.readyState >= 2) onReady(); else video.addEventListener('loadeddata', onReady, { once:true });

    startFrameWatch(video);
    const onTap = () => { safePlay(); if (video.paused){ video.setAttribute('controls',''); safePlay(); } };
    video.addEventListener('touchstart', onTap, { passive:true, once:true });
    video.addEventListener('click', onTap, { once:true });
    video.addEventListener('play', updatePauseBtnUI);
    video.addEventListener('pause', updatePauseBtnUI);

    bindTimeline(true);
  }

  (function boot(){
    const onReady = () => safePlay();
    if (video.readyState >= 2) onReady(); else video.addEventListener('loadeddata', onReady, { once:true });
    startFrameWatch(video);
    const onTap = () => { safePlay(); if (video.paused){ video.setAttribute('controls',''); safePlay(); } };
    video.addEventListener('touchstart', onTap, { passive:true, once:true });
    video.addEventListener('click', onTap, { once:true });
    video.addEventListener('play', updatePauseBtnUI);
    video.addEventListener('pause', updatePauseBtnUI);
  })();

  function tryRecoverAfterReturn(){
    if (!IS_IOS) { safePlay(); return; }
    safePlay();
    setTimeout(() => { if (!video.paused && framesStale(900)) rebuildVideoInline(); }, 350);
  }
  document.addEventListener('visibilitychange', () => { if (document.visibilityState === 'visible') tryRecoverAfterReturn(); });
  window.addEventListener('pageshow', tryRecoverAfterReturn);
  window.addEventListener('focus', tryRecoverAfterReturn);

  /* ===== Fullscreen handling ===== */
  function isFullscreen(){ return document.fullscreenElement || document.webkitFullscreenElement || null; }
  async function enterNativeFS(){
    if (wrapper.requestFullscreen) return wrapper.requestFullscreen();
    if (wrapper.webkitRequestFullscreen) return wrapper.webkitRequestFullscreen();
  }
  async function exitNativeFS(){
    if (document.exitFullscreen) return document.exitFullscreen();
    if (document.webkitExitFullscreen) return document.webkitExitFullscreen();
  }
  function updateFsBtnUI(full){
    fsBtn.textContent = full ? '⤡' : '⤢';
    fsBtn.setAttribute('aria-label', full ? 'Exit fullscreen' : 'Enter fullscreen');
  }

  function updatePauseBtnUI(){
    if (video.paused){
      pauseBtn.textContent = '▶';
      pauseBtn.setAttribute('aria-label','Play');
    } else {
      pauseBtn.textContent = '❚❚';
      pauseBtn.setAttribute('aria-label','Pause');
    }
  }
  pauseBtn.addEventListener('click', () => {
    if (video.paused) safePlay();
    else video.pause();
    updatePauseBtnUI();
  });

  /* Simulated fullscreen for iOS */
  let fsOverlay = null, placeholder = null, overlayOpen = false;
  function ensureOverlay(){
    if (fsOverlay) return fsOverlay;
    fsOverlay = document.createElement('div');
    fsOverlay.className = 'fs-overlay';
    document.body.appendChild(fsOverlay);
    return fsOverlay;
  }
  function openOverlay(){
    if (overlayOpen) return;
    ensureOverlay();
    placeholder = document.createComment('video-placeholder');
    wrapper.parentNode.insertBefore(placeholder, wrapper);
    fsOverlay.appendChild(wrapper);
    fsOverlay.classList.add('open');
    overlayOpen = true;
    updateFsBtnUI(true);
    safePlay();
    updatePauseBtnUI();
  }
  function closeOverlay(){
    if (!overlayOpen) return;
    fsOverlay.classList.remove('open');
    if (placeholder && placeholder.parentNode){
      placeholder.parentNode.insertBefore(wrapper, placeholder);
      placeholder.remove();
      placeholder = null;
    }
    overlayOpen = false;
    updateFsBtnUI(false);
    setTimeout(() => { if (!video.paused && framesStale(700)) rebuildVideoInline(); }, 300);
  }

  fsBtn.addEventListener('click', async () => {
    if (IS_IOS){
      overlayOpen ? closeOverlay() : openOverlay();
    } else {
      if (!isFullscreen()){ await enterNativeFS(); updateFsBtnUI(true); }
      else { await exitNativeFS(); updateFsBtnUI(false); }
    }
  });

  document.addEventListener('fullscreenchange', () => { updateFsBtnUI(!!isFullscreen()); updatePauseBtnUI(); });
  document.addEventListener('webkitfullscreenchange', () => { updateFsBtnUI(!!isFullscreen()); updatePauseBtnUI(); });

  /* ===== Timeline: fullscreen only ===== */
  const tl = document.getElementById('videoTimeline');
  const tlTrack = tl.querySelector('.track');
  const tlBuffer = document.getElementById('tlBuffer');
  const tlProgress = document.getElementById('tlProgress');
  const tlHandle = document.getElementById('tlHandle');

  let dragging = false;
  let timelineBound = false;

  function fmtPct(x){ return Math.max(0, Math.min(100, x)); }

  function updateBuffer(){
    try{
      if (!video.buffered || video.buffered.length === 0 || !isFinite(video.duration)) { tlBuffer.style.width = '0%'; return; }
      let end = 0;
      for (let i=0;i<video.buffered.length;i++){ end = Math.max(end, video.buffered.end(i)); }
      const pct = fmtPct( (end / video.duration) * 100 );
      tlBuffer.style.width = pct + '%';
    }catch(e){}
  }

  function updateProgressUI(){
    const dur = video.duration || 0;
    const ct = video.currentTime || 0;
    const pct = dur ? (ct / dur) * 100 : 0;
    tlProgress.style.width = pct + '%';
    tlHandle.style.left = `calc(${pct}% )`;
    tl.setAttribute('aria-valuenow', Math.round(pct));
  }

  function rafUpdate(){ if (!dragging) updateProgressUI(); requestAnimationFrame(rafUpdate); }

  function percentFromEvent(evt){
    const rect = tlTrack.getBoundingClientRect();
    const clientX = (evt.clientX !== undefined) ? evt.clientX : (evt.touches && evt.touches[0] ? evt.touches[0].clientX : 0);
    const x = clientX - rect.left;
    return Math.max(0, Math.min(1, x / rect.width));
  }

  function seekToPercent(p){
    if (!isFinite(video.duration) || video.duration <= 0) return;
    const t = p * video.duration;
    try { video.currentTime = t; } catch(e){}
  }

  function onPointerDown(e){
    dragging = true;
    tl.classList.add('dragging');
    const p = percentFromEvent(e);
    seekToPercent(p);
    updateProgressUI();
    e.preventDefault();
  }
  function onPointerMove(e){
    if (!dragging) return;
    const p = percentFromEvent(e);
    seekToPercent(p);
    updateProgressUI();
    e.preventDefault();
  }
  function onPointerUp(){
    if (!dragging) return;
    dragging = false;
    tl.classList.remove('dragging');
    safePlay();
  }

  function bindTimeline(rebind=false){
    if (!timelineBound){
      tlTrack.addEventListener('pointerdown', onPointerDown);
      window.addEventListener('pointermove', onPointerMove);
      window.addEventListener('pointerup', onPointerUp);
      tlTrack.addEventListener('touchstart', (e)=>onPointerDown(e.touches[0]), { passive:false });
      window.addEventListener('touchmove', (e)=>{ if (dragging) onPointerMove(e.touches[0]); }, { passive:false });
      window.addEventListener('touchend', onPointerUp);
      requestAnimationFrame(rafUpdate);
      timelineBound = true;
    }

    video.addEventListener('loadedmetadata', updateProgressUI);
    video.addEventListener('timeupdate', updateProgressUI);
    video.addEventListener('progress', updateBuffer);
    video.addEventListener('loadeddata', updateBuffer);

    if (rebind){ updateProgressUI(); updateBuffer(); }
  }

  bindTimeline();

  /* ===== CTA: mobile-only delayed nav (no spinner) ===== */
  const joinCta = document.getElementById('joinCta');
  const isMobile = window.matchMedia('(max-width: 979px)');
  const DELAY_MS = 900;
  if (joinCta){
    joinCta.addEventListener('click', (e) => {
      if (!isMobile.matches) return;
      if (joinCta.classList.contains('loading')) return;
      e.preventDefault();
      joinCta.classList.add('loading');
      joinCta.setAttribute('aria-busy','true');
      const href = joinCta.getAttribute('href') || '/';
      setTimeout(() => {
        joinCta.classList.remove('loading');
        joinCta.removeAttribute('aria-busy');
        window.location.href = href;
      }, DELAY_MS);
    }, { passive:false });
  }
</script>

</body>
</html>
